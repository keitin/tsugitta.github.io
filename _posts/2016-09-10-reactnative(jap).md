---
title: ReactNative(Jap)
date: 2016-09-10
description: Component-oriented programming is awesome
---

Diaryのはずが三ヶ月以上空いてた。
英語に捕らわれない方が良い気がしてきた。

## コンポーネント志向の強さ

最近、ReactNativeを書いている。所謂コンポーネント志向で、とにかく書きやすいしわかりやすい。

それまでは、iOSはネイティブでしかやったことなかったのだけれど、ReactNativeの方が遥かに書きやすい。間違ってるかもしれないけど、コンポーネント志向の良い所は、各コンポーネントにビジネスロジックを持たせてしまって良い所（実装はそのコンポーネントに紐づくサービスに書く）。

みんなReactNativeを使って日本を盛り上げていきましょう、という記事。

### 一般のiOS開発

一般のiOS開発と言えばMVCがよく使われている感ある。

MVCでは、ビジネスロジックは全てモデルに書き、ビューには書かない。そのため、必然的にビューとモデルを接続する仕組みが必要になる。

- ビューのイベントをコントローラが受け取り、該当するモデルに渡す
    - NotificationやaddTarget、Delegate等
- モデルからのフィードバックをコントローラが受け取り、ビューに渡す
    - reloadData等のコールバックをVCが用意し、モデルのロジックに渡す等

おかげでコントローラがFatになっていく。TableViewの各Cellの中のButtonとかコントローラからアクセスしづらいビューと紐付けるのとかは普通にしんどいし（Notification安定）、同期がうまくいっているかのテストも必要だし、険しい。

そこで自分はMVVMをよく取り入れるようになった。これの特徴は以下。

- VMが画面上の状態を持つ
  - ビジネスロジックをモデルでなくVMに実装してしまう所も多いみたい
- ビューは、VMの状態によって一意に描画される
- モデル(VM)からのフィードバックをビューに渡す仕組みはBinding
  - 最初に一度Bindingを設定してしまえば、あとはVMの値を変えるだけ
- ビューのイベント取得についてはMVC同様に行う
  - Bindingを応用することで表現力は高まる

すなわち、MVCにおける「モデルからのフィードバックをコントローラが受け取り、ビューに渡す」を、Bindingにより済ませることで、意識する必要がなくなった。
これは自分にとっては驚くほど価値があることだった。というのも、状態の多い画面について、モデルからのフィードバックをビューに渡すだけで管理するのは大変だったからだ。

複雑な画面では「えっとこの時はボタンAが出現してるはずだから、それを一旦非表示にして・・あれ、この時画像Cは出ているんだっけ・・」みたいに、その時その時で画面の状態がどうなっているか追うのが難しかった。だからVMが状態をプロパティとして客観的に定義してくれるのは非常に管理がしやすくなることに繋がる。あとは状態をどう変化させていくかだけを考えれば良い。

これから複雑な画面を作るときはMVVMだなーと思っていた。

### ReactNativeでの開発

まず、ReactNativeはデータバインディングを前提としており、各コンポーネントが状態を持っている。そして各コンポーネントのRenderメソッド内でその状態に直接アクセスし、描画を自由に変える。MVVMの良さをまず兼ね備えているということ。

また、先述の通り、ReactNativeでは、各コンポーネントにビジネスロジックを持たせる（呼び出す）ことを是としている。MVC、MVVMでは、ビューは無思考で与えられた情報を表示する入れ物でしかなく、それ自身はビジネスロジックは持つ（呼び出す）べきでないとされている（よね）。

もちろん、全てのコンポーネントに無秩序にロジックを呼ばせてしまうよりは、「データ（props）を与えてただ表示させるだけ」のコンポーネント（特に末端）を意識的に作った方が良いだろうけれど、とにかくコンポーネントにロジックを呼び出させたい時に、悩まずにその場で呼ばせることができる。

そうすると、MVVMでも解決されていなかった「ビューのイベントをコントローラが受け取り、該当するモデルに渡す」手間がなくなる。コンポーネントが、自身のイベントハンドラで、直接ビジネスロジックを呼べてしまうからだ。

ということで、MVC、MVVMよりも感動するほど扱いやすい。

## ReactNativeの強さ

アーキテクチャ的には上記のような感じでまとまるのかなと思っているけど、ReactNativeのそれ以上に強い利点は、ビューの描画が死ぬほどやりやすいということ（実際に3度くらい死んでる）。

UIKitの描画って正直もう意味わからないほどに使いづらい（ソースコードで書く場合）。

- 現状、どういったビュー構成なのかがわかりづらい
  - 動的にaddSubviewとかする場合、意識しないとカオス極まる
- 装飾がしづらい
  - 座標管理
  - 例えばBorderBottomだけ有するTextFieldはさっと作れるか
    - さらにonFocusの時だけその色をハイライトすることはできるか

多くの場合、ビューは重なり合うことはないが、UIKitは「重なり合わない」という情報を描画に用いることができない。だから毎回座標を計算して配置しないといけない。

ReactNativeでは、HTMLライクに記述することができる。「重なり合わない」ことを強力な情報としてうまくやってくれる。また、ひと目でビュー構成がわかる。

さらに装飾もCSSライクに記述することができる。これがもう死ぬほど楽な上に、heightを0とかにすれば「重なり合わない」ことによる類推から勝手に詰めてくれるため、stateに応じて表示/非表示の切り替えなんかを他の要素を無視して行える。

`position: absolute` も使えるので別に「重なり合わない」ことを前提とされていることによる不利益は無い。

ReactNativeの強力な利点はまだあって、実質ビルドが0秒であるということ。

アプリがJSを読み込む形なので、

ビルド（初回のみ） →　JSを書き換える　→　アプリ上でリロード（0秒） → JSを書き換える →　アプリ上でリロード（0秒）..

という感じで、ビューの微調整とかの確認が死ぬほどやりやすい（実際に5度くらい死んでる）。

## ReactNativeのデメリット

今のところないみたい。多分かなりデリケートな何かをする時とかに不便があるのだろうけど、ネイティブのコードも組み込めるので何も怖くない気がする。

## 綺麗なコード

話は変わるけど、今いるチームのコードが死ぬほど美しくて、新しく書き加える時に副作用を気にする必要があまり無くて幸せ。コンポーネント志向の影響もあるとは思うけど、やはりコードの綺麗さはモチベーションにも開発スピードにも繋がるから本当に追求しなきゃなと思う。
